<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Solana Miner</title>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

    <style>
        :root {
            --sol-green: #14F195;
            --sol-purple: #9945FF;
            --bg-dark: #090909;
            --card-bg: #1a1a1a;
            --text-main: #ffffff;
            --text-sec: #aaaaaa;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
        }

        /* LOGIN OVERLAY */
        #login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .login-box {
            background: #111; padding: 30px; border-radius: 20px; border: 1px solid #333;
            text-align: center;
        }
        input[type="password"] {
            padding: 10px; border-radius: 5px; border: 1px solid #444; background: #222; color: white;
            margin-bottom: 10px; font-size: 16px; text-align: center;
        }

        /* DASHBOARD UI */
        .container { max-width: 1200px; margin: 0 auto; display: none; } /* Hidden until login */
        
        .header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;
            border-bottom: 1px solid #333; padding-bottom: 20px;
        }
        .stats-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;
        }
        .stat-card {
            background: var(--card-bg); padding: 20px; border-radius: 15px; border: 1px solid #333;
            display: flex; align-items: center; gap: 15px;
        }
        .stat-icon {
            width: 50px; height: 50px; background: rgba(20, 241, 149, 0.1); color: var(--sol-green);
            border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px;
        }

        /* TABLE */
        .table-container {
            background: var(--card-bg); border-radius: 15px; border: 1px solid #333; overflow: hidden;
        }
        table { width: 100%; border-collapse: collapse; text-align: left; }
        th, td { padding: 15px 20px; border-bottom: 1px solid #333; }
        th { background: #222; color: var(--sol-green); font-weight: 600; font-size: 14px; text-transform: uppercase; }
        tr:hover { background: #222; }
        .user-id { font-family: monospace; color: #888; font-size: 12px; }
        .sol-val { color: var(--sol-green); font-weight: bold; }

        .btn {
            background: var(--sol-purple); color: white; border: none; padding: 10px 20px;
            border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s;
        }
        .btn:hover { opacity: 0.9; }
        .btn-refresh { background: #333; display: flex; align-items: center; gap: 5px;}

        /* Responsive */
        @media (max-width: 768px) {
            .table-container { overflow-x: auto; }
            th, td { padding: 10px; font-size: 14px; }
        }
    </style>
</head>
<body>

    <!-- LOGIN SCREEN -->
    <div id="login-overlay">
        <div class="login-box">
            <h2 style="color: var(--sol-green);">Admin Access</h2>
            <input type="password" id="pin-input" placeholder="Enter PIN (1234)">
            <br>
            <button class="btn" onclick="checkPin()">Enter Dashboard</button>
        </div>
    </div>

    <!-- MAIN DASHBOARD -->
    <div class="container" id="main-dash">
        <div class="header">
            <div>
                <h1 style="margin: 0;">Solana Miner <span style="color: var(--sol-green);">Admin</span></h1>
                <span style="color: #666; font-size: 12px;">Real-time Database View</span>
            </div>
            <button class="btn btn-refresh" onclick="loadData()">
                <i class="ri-refresh-line"></i> Refresh Data
            </button>
        </div>

        <!-- STATS -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon"><i class="ri-user-3-fill"></i></div>
                <div>
                    <div style="font-size: 12px; color: #888;">Total Users</div>
                    <div style="font-size: 24px; font-weight: bold;" id="total-users">0</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="color: var(--sol-purple); background: rgba(153,69,255,0.1);"><i class="ri-coins-fill"></i></div>
                <div>
                    <div style="font-size: 12px; color: #888;">Total Mined (SOL)</div>
                    <div style="font-size: 24px; font-weight: bold;" id="total-sol">0.00</div>
                </div>
            </div>
        </div>

        <!-- DATA TABLE -->
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Username</th>
                        <th>User ID (Key)</th>
                        <th>Score (Points)</th>
                        <th>Wallet Value (SOL)</th>
                        <th>Energy</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    <tr><td colspan="6" style="text-align:center;">Loading Data...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script type="module">
        // 1. IMPORT FIREBASE (Using CDN for standalone HTML)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // 2. YOUR CONFIGURATION (Exact copy from your app)
        const firebaseConfig = {
            apiKey: "AIzaSyAghmBjfnclb4yIwEmx7Uxssj7cpZkea1Q",
            authDomain: "solanacoin-6d9a8.firebaseapp.com",
            databaseURL: "https://solanacoin-6d9a8-default-rtdb.firebaseio.com",
            projectId: "solanacoin-6d9a8",
            storageBucket: "solanacoin-6d9a8.firebasestorage.app",
            messagingSenderId: "269025348490",
            appId: "1:269025348490:web:87c95514a1d86485169673",
            measurementId: "G-00X84VW123"
        };

        // Initialize
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- AUTH LOGIC (Simple PIN) ---
        window.checkPin = () => {
            const pin = document.getElementById('pin-input').value;
            if(pin === "1234") { // <--- CHANGE PIN HERE
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('main-dash').style.display = 'block';
                loadData();
            } else {
                alert("Wrong PIN");
            }
        }

        // --- DATA LOADING LOGIC ---
        window.loadData = async () => {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; padding: 30px;">Fetching Data...</td></tr>';

            try {
                const usersRef = ref(db, 'sol_users');
                const snapshot = await get(usersRef);

                if (snapshot.exists()) {
                    const data = snapshot.val();
                    const usersArray = [];

                    // Convert Object to Array
                    Object.keys(data).forEach(key => {
                        usersArray.push({
                            id: key,
                            ...data[key]
                        });
                    });

                    // Sort by Score (Highest first)
                    usersArray.sort((a, b) => (b.score || 0) - (a.score || 0));

                    // Update Stats
                    document.getElementById('total-users').innerText = usersArray.length;
                    
                    let totalScore = 0;
                    usersArray.forEach(u => totalScore += (u.score || 0));
                    // Assuming 10,000 Points = 1 SOL (Based on your app logic)
                    document.getElementById('total-sol').innerText = (totalScore / 10000).toFixed(2);

                    // Render Table
                    tbody.innerHTML = '';
                    usersArray.forEach((user, index) => {
                        const score = user.score || 0;
                        const solValue = (score / 10000).toFixed(4);
                        const energy = user.energy || 0;
                        const username = user.username || "Unknown";

                        const row = `
                            <tr>
                                <td>${index + 1}</td>
                                <td style="font-weight:bold; color:white;">${username}</td>
                                <td class="user-id">${user.id}</td>
                                <td>${Math.floor(score).toLocaleString()}</td>
                                <td class="sol-val">${solValue} SOL</td>
                                <td>${energy}</td>
                            </tr>
                        `;
                        tbody.innerHTML += row;
                    });

                } else {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">No Users Found</td></tr>';
                    document.getElementById('total-users').innerText = "0";
                }
            } catch (error) {
                console.error(error);
                tbody.innerHTML = `<tr><td colspan="6" style="text-align:center; color:red;">Error: ${error.message}</td></tr>`;
            }
        }
    </script>
</body>
</html>
